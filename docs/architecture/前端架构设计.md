# Lumina 前端架构设计

## 一、设计原则

1. **现代化技术栈** - 使用 Vue 3 + TypeScript + Element Plus
2. **前后端分离** - 完全独立的前端项目，通过 RESTful API 通信
3. **类型安全** - 全面使用 TypeScript，确保类型安全
4. **组件化开发** - 基于组件化思想，提高代码复用性
5. **工程化规范** - 统一的代码规范、构建流程、开发工具
6. **可维护性** - 清晰的目录结构，便于维护和扩展

---

## 二、技术栈选型

### 2.1 核心框架

| 技术 | 版本 | 选型理由 |
|------|------|---------|
| **Vue** | **3.4+** | 现代化前端框架，Composition API，性能优异 |
| **TypeScript** | **5.3+** | 类型安全，提升代码质量和开发体验 |
| **Vite** | **5.0+** | 快速构建工具，开发体验优秀 |

### 2.2 UI 组件库

| 技术 | 版本 | 选型理由 |
|------|------|---------|
| **Element Plus** | **2.5+** | Vue 3 生态的成熟 UI 组件库，组件丰富 |
| **@element-plus/icons-vue** | **2.3+** | Element Plus 官方图标库 |

### 2.3 状态管理

| 技术 | 版本 | 选型理由 |
|------|------|---------|
| **Pinia** | **2.1+** | Vue 3 官方推荐的状态管理库，替代 Vuex |

### 2.4 路由管理

| 技术 | 版本 | 选型理由 |
|------|------|---------|
| **Vue Router** | **4.2+** | Vue 3 官方路由库 |

### 2.5 HTTP 请求

| 技术 | 版本 | 选型理由 |
|------|------|---------|
| **Axios** | **1.6+** | 成熟的 HTTP 客户端，支持拦截器、请求取消等 |

### 2.6 工具库

| 技术 | 版本 | 选型理由 |
|------|------|---------|
| **dayjs** | **1.11+** | 轻量级日期处理库 |
| **lodash-es** | **4.17+** | 工具函数库（按需引入） |
| **nprogress** | **0.2+** | 页面加载进度条 |

### 2.7 代码质量

| 技术 | 版本 | 选型理由 |
|------|------|---------|
| **ESLint** | **8.57+** | 代码检查工具 |
| **Prettier** | **3.2+** | 代码格式化工具 |
| **Stylelint** | **16.0+** | CSS 代码检查工具 |

### 2.8 构建工具

| 技术 | 版本 | 选型理由 |
|------|------|---------|
| **Vite** | **5.0+** | 快速构建工具，开发体验优秀 |
| **@vitejs/plugin-vue** | **5.0+** | Vite 的 Vue 插件 |

### 2.9 样式方案

| 技术 | 版本 | 选型理由 |
|------|------|---------|
| **SCSS/SASS** | **1.69+** | CSS 预处理器，支持变量、嵌套等 |
| **PostCSS** | **8.4+** | CSS 后处理器 |

### 2.10 测试框架（可选）

| 技术 | 版本 | 选型理由 |
|------|------|---------|
| **Vitest** | **1.2+** | 基于 Vite 的单元测试框架 |
| **@vue/test-utils** | **2.4+** | Vue 组件测试工具 |

---

## 三、项目结构设计

### 3.1 目录结构

```
lumina-frontend/
├── .env                        # 环境变量配置
├── .env.development            # 开发环境变量
├── .env.production             # 生产环境变量
├── .eslintrc.cjs              # ESLint 配置
├── .prettierrc                # Prettier 配置
├── .stylelintrc.cjs           # Stylelint 配置
├── index.html                  # HTML 入口文件
├── package.json                # 项目依赖配置
├── pnpm-lock.yaml             # 依赖锁定文件（使用 pnpm）
├── tsconfig.json               # TypeScript 配置
├── vite.config.ts             # Vite 构建配置
│
├── public/                     # 静态资源目录
│   ├── favicon.ico
│   └── logo.png
│
├── src/                        # 源代码目录
│   ├── api/                    # API 接口定义
│   │   ├── modules/            # 按模块划分的 API
│   │   │   ├── agent.ts        # Agent 相关 API
│   │   │   ├── user.ts         # 用户相关 API
│   │   │   └── system.ts        # 系统相关 API
│   │   ├── request.ts          # Axios 请求封装
│   │   ├── types.ts            # API 类型定义
│   │   └── index.ts            # API 统一导出
│   │
│   ├── assets/                 # 静态资源
│   │   ├── images/             # 图片资源
│   │   ├── icons/              # 图标资源
│   │   └── styles/             # 全局样式
│   │       ├── variables.scss  # SCSS 变量
│   │       ├── mixins.scss     # SCSS 混入
│   │       └── index.scss      # 全局样式入口
│   │
│   ├── components/             # 公共组件
│   │   ├── common/             # 通用组件
│   │   │   ├── PageHeader/     # 页面头部组件
│   │   │   ├── PageTable/      # 表格组件封装
│   │   │   ├── PageForm/       # 表单组件封装
│   │   │   └── PageDialog/     # 对话框组件封装
│   │   └── business/           # 业务组件
│   │
│   ├── composables/            # 组合式函数（Composables）
│   │   ├── useTable.ts         # 表格相关逻辑
│   │   ├── useForm.ts          # 表单相关逻辑
│   │   ├── usePagination.ts    # 分页相关逻辑
│   │   └── usePermission.ts    # 权限相关逻辑
│   │
│   ├── directives/             # 自定义指令
│   │   ├── permission.ts       # 权限指令
│   │   └── loading.ts          # 加载指令
│   │
│   ├── layouts/                # 布局组件
│   │   ├── DefaultLayout.vue    # 默认布局
│   │   ├── BlankLayout.vue      # 空白布局
│   │   └── components/         # 布局子组件
│   │       ├── AppHeader.vue   # 顶部导航
│   │       ├── AppSidebar.vue  # 侧边栏
│   │       └── AppBreadcrumb.vue # 面包屑
│   │
│   ├── router/                 # 路由配置
│   │   ├── index.ts            # 路由入口
│   │   ├── modules/            # 路由模块
│   │   │   ├── agent.ts        # Agent 路由
│   │   │   ├── user.ts         # 用户路由
│   │   │   └── system.ts        # 系统路由
│   │   ├── guards.ts           # 路由守卫
│   │   └── types.ts            # 路由类型定义
│   │
│   ├── stores/                 # Pinia 状态管理
│   │   ├── modules/            # 状态模块
│   │   │   ├── user.ts         # 用户状态
│   │   │   ├── app.ts          # 应用状态
│   │   │   └── permission.ts   # 权限状态
│   │   └── index.ts            # Store 入口
│   │
│   ├── types/                  # TypeScript 类型定义
│   │   ├── api.ts              # API 类型
│   │   ├── common.ts           # 通用类型
│   │   ├── router.ts           # 路由类型
│   │   └── store.ts             # Store 类型
│   │
│   ├── utils/                  # 工具函数
│   │   ├── auth.ts             # 认证相关工具
│   │   ├── storage.ts          # 本地存储工具
│   │   ├── format.ts           # 格式化工具
│   │   ├── validate.ts         # 校验工具
│   │   └── index.ts            # 工具函数统一导出
│   │
│   ├── views/                  # 页面组件
│   │   ├── agent/              # Agent 相关页面
│   │   │   ├── index.vue       # Agent 列表页
│   │   │   ├── detail.vue       # Agent 详情页
│   │   │   └── components/     # 页面子组件
│   │   ├── user/               # 用户相关页面
│   │   └── system/             # 系统相关页面
│   │
│   ├── App.vue                 # 根组件
│   ├── main.ts                 # 应用入口
│   └── env.d.ts                # 环境变量类型声明
│
├── tests/                      # 测试文件（可选）
│   ├── unit/                   # 单元测试
│   └── e2e/                    # 端到端测试
│
└── docs/                       # 项目文档（可选）
    ├── README.md
    └── CHANGELOG.md
```

### 3.2 目录说明

#### 3.2.1 api/ - API 接口层
- **职责**: 定义所有后端 API 接口
- **组织方式**: 按业务模块划分文件
- **规范**: 每个 API 文件包含类型定义和接口方法

#### 3.2.2 components/ - 组件库
- **职责**: 可复用的 Vue 组件
- **分类**:
  - `common/` - 通用组件（表格、表单、对话框等）
  - `business/` - 业务组件（特定业务场景）

#### 3.2.3 composables/ - 组合式函数
- **职责**: 封装可复用的组合式逻辑
- **示例**: `useTable`、`useForm`、`usePagination`

#### 3.2.4 layouts/ - 布局组件
- **职责**: 定义页面布局结构
- **类型**: 默认布局、空白布局等

#### 3.2.5 router/ - 路由配置
- **职责**: 定义应用路由
- **组织方式**: 按模块划分路由文件
- **包含**: 路由守卫、路由元信息

#### 3.2.6 stores/ - 状态管理
- **职责**: 全局状态管理
- **组织方式**: 按功能模块划分 Store

#### 3.2.7 views/ - 页面组件
- **职责**: 业务页面组件
- **组织方式**: 按业务模块划分目录

---

## 四、核心功能设计

### 4.1 HTTP 请求封装

#### 4.1.1 Axios 实例配置

```typescript
// src/api/request.ts
import axios from 'axios'
import type { AxiosInstance, AxiosRequestConfig, AxiosResponse } from 'axios'
import { ElMessage } from 'element-plus'
import { useUserStore } from '@/stores/modules/user'
import router from '@/router'

// 创建 Axios 实例
const service: AxiosInstance = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json;charset=UTF-8'
  }
})

// 请求拦截器
service.interceptors.request.use(
  (config: AxiosRequestConfig) => {
    // 添加 Token
    const userStore = useUserStore()
    if (userStore.token) {
      config.headers = config.headers || {}
      config.headers['Authorization'] = `Bearer ${userStore.token}`
    }
    return config
  },
  (error) => {
    return Promise.reject(error)
  }
)

// 响应拦截器
service.interceptors.response.use(
  (response: AxiosResponse) => {
    const res = response.data
    
    // 统一响应格式处理
    if (res.code === 200) {
      return res
    } else {
      // 业务错误处理
      ElMessage.error(res.msg || '请求失败')
      
      // 401 未授权，跳转登录
      if (res.code === 401) {
        const userStore = useUserStore()
        userStore.logout()
        router.push('/login')
      }
      
      return Promise.reject(new Error(res.msg || '请求失败'))
    }
  },
  (error) => {
    // HTTP 错误处理
    ElMessage.error(error.message || '网络错误')
    return Promise.reject(error)
  }
)

export default service
```

#### 4.1.2 API 接口定义示例

```typescript
// src/api/modules/agent.ts
import request from '../request'
import type { R, PageResult } from '../types'

// 类型定义
export interface AgentVO {
  agentId: number
  agentName: string
  agentType: string
  description?: string
  status: number
  createTime: string
  updateTime: string
}

export interface CreateAgentDTO {
  agentName: string
  agentType: string
  description?: string
}

export interface QueryAgentDTO {
  agentName?: string
  agentType?: string
  pageNum?: number
  pageSize?: number
}

// API 方法
export function createAgent(data: CreateAgentDTO) {
  return request.post<R<AgentVO>>('/api/v1/agents', data)
}

export function getAgent(id: number) {
  return request.get<R<AgentVO>>(`/api/v1/agents/${id}`)
}

export function listAgents(params: QueryAgentDTO) {
  return request.get<R<PageResult<AgentVO>>>('/api/v1/agents', { params })
}

export function updateAgent(id: number, data: CreateAgentDTO) {
  return request.put<R<AgentVO>>(`/api/v1/agents/${id}`, data)
}

export function deleteAgent(id: number) {
  return request.delete<R<void>>(`/api/v1/agents/${id}`)
}
```

### 4.2 路由管理

#### 4.2.1 路由配置

```typescript
// src/router/index.ts
import { createRouter, createWebHistory } from 'vue-router'
import type { RouteRecordRaw } from 'vue-router'
import { setupRouterGuards } from './guards'
import { basicRoutes } from './modules'

const routes: RouteRecordRaw[] = [
  {
    path: '/',
    redirect: '/dashboard'
  },
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/views/login/index.vue'),
    meta: {
      title: '登录',
      requiresAuth: false
    }
  },
  {
    path: '/',
    component: () => import('@/layouts/DefaultLayout.vue'),
    children: [
      ...basicRoutes
    ]
  }
]

const router = createRouter({
  history: createWebHistory(),
  routes,
  scrollBehavior: () => ({ left: 0, top: 0 })
})

// 设置路由守卫
setupRouterGuards(router)

export default router
```

#### 4.2.2 路由守卫

```typescript
// src/router/guards.ts
import type { Router } from 'vue-router'
import { useUserStore } from '@/stores/modules/user'
import { usePermissionStore } from '@/stores/modules/permission'
import { ElMessage } from 'element-plus'
import NProgress from 'nprogress'
import 'nprogress/nprogress.css'

NProgress.configure({ showSpinner: false })

export function setupRouterGuards(router: Router) {
  // 前置守卫
  router.beforeEach(async (to, from, next) => {
    NProgress.start()
    
    const userStore = useUserStore()
    const permissionStore = usePermissionStore()
    
    // 检查是否需要认证
    if (to.meta.requiresAuth !== false) {
      if (!userStore.token) {
        next({
          path: '/login',
          query: { redirect: to.fullPath }
        })
        return
      }
      
      // 检查权限
      if (!permissionStore.hasPermission(to.path)) {
        ElMessage.error('无权限访问')
        next('/403')
        return
      }
    }
    
    next()
  })
  
  // 后置守卫
  router.afterEach(() => {
    NProgress.done()
  })
  
  // 错误处理
  router.onError((error) => {
    console.error('路由错误:', error)
    NProgress.done()
  })
}
```

### 4.3 状态管理（Pinia）

#### 4.3.1 用户状态

```typescript
// src/stores/modules/user.ts
import { defineStore } from 'pinia'
import { ref } from 'vue'
import type { UserInfo } from '@/types/api'
import { login, getUserInfo, logout } from '@/api/modules/user'
import { getToken, setToken, removeToken } from '@/utils/auth'

export const useUserStore = defineStore('user', () => {
  const token = ref<string>(getToken() || '')
  const userInfo = ref<UserInfo | null>(null)
  
  // 登录
  const loginAction = async (username: string, password: string) => {
    const res = await login({ username, password })
    token.value = res.data.token
    setToken(res.data.token)
    await getUserInfoAction()
  }
  
  // 获取用户信息
  const getUserInfoAction = async () => {
    const res = await getUserInfo()
    userInfo.value = res.data
  }
  
  // 登出
  const logoutAction = async () => {
    await logout()
    token.value = ''
    userInfo.value = null
    removeToken()
  }
  
  return {
    token,
    userInfo,
    loginAction,
    getUserInfoAction,
    logoutAction
  }
})
```

#### 4.3.2 应用状态

```typescript
// src/stores/modules/app.ts
import { defineStore } from 'pinia'
import { ref } from 'vue'

export const useAppStore = defineStore('app', () => {
  const sidebarCollapsed = ref<boolean>(false)
  const theme = ref<string>('light')
  
  const toggleSidebar = () => {
    sidebarCollapsed.value = !sidebarCollapsed.value
  }
  
  const setTheme = (newTheme: string) => {
    theme.value = newTheme
  }
  
  return {
    sidebarCollapsed,
    theme,
    toggleSidebar,
    setTheme
  }
})
```

### 4.4 组合式函数（Composables）

#### 4.4.1 表格组合式函数

```typescript
// src/composables/useTable.ts
import { ref, reactive } from 'vue'
import type { PageResult } from '@/types/api'

export function useTable<T>(
  fetchFn: (params: any) => Promise<{ data: PageResult<T> }>
) {
  const loading = ref(false)
  const tableData = ref<T[]>([])
  const pagination = reactive({
    pageNum: 1,
    pageSize: 10,
    total: 0
  })
  
  const loadData = async () => {
    loading.value = true
    try {
      const res = await fetchFn({
        pageNum: pagination.pageNum,
        pageSize: pagination.pageSize
      })
      tableData.value = res.data.list
      pagination.total = res.data.total
    } finally {
      loading.value = false
    }
  }
  
  const handlePageChange = (page: number) => {
    pagination.pageNum = page
    loadData()
  }
  
  const handleSizeChange = (size: number) => {
    pagination.pageSize = size
    pagination.pageNum = 1
    loadData()
  }
  
  return {
    loading,
    tableData,
    pagination,
    loadData,
    handlePageChange,
    handleSizeChange
  }
}
```

### 4.5 工具函数

#### 4.5.1 认证工具

```typescript
// src/utils/auth.ts
const TOKEN_KEY = 'lumina_token'

export function getToken(): string | null {
  return localStorage.getItem(TOKEN_KEY)
}

export function setToken(token: string): void {
  localStorage.setItem(TOKEN_KEY, token)
}

export function removeToken(): void {
  localStorage.removeItem(TOKEN_KEY)
}
```

#### 4.5.2 格式化工具

```typescript
// src/utils/format.ts
import dayjs from 'dayjs'

export function formatDate(
  date: string | Date,
  format: string = 'YYYY-MM-DD HH:mm:ss'
): string {
  return dayjs(date).format(format)
}

export function formatFileSize(bytes: number): string {
  if (bytes === 0) return '0 B'
  const k = 1024
  const sizes = ['B', 'KB', 'MB', 'GB']
  const i = Math.floor(Math.log(bytes) / Math.log(k))
  return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i]
}
```

---

## 五、配置文件设计

### 5.1 Vite 配置

```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src')
    }
  },
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '')
      }
    }
  },
  build: {
    outDir: 'dist',
    sourcemap: false,
    chunkSizeWarningLimit: 1500
  }
})
```

### 5.2 TypeScript 配置

```json
// tsconfig.json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "preserve",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  },
  "include": ["src/**/*.ts", "src/**/*.d.ts", "src/**/*.tsx", "src/**/*.vue"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

### 5.3 环境变量配置

```bash
# .env.development
VITE_API_BASE_URL=http://localhost:8080
VITE_APP_TITLE=Lumina 开发环境
```

```bash
# .env.production
VITE_API_BASE_URL=https://api.lumina.com
VITE_APP_TITLE=Lumina
```

---

## 六、开发规范

### 6.1 命名规范

#### 6.1.1 文件命名
- **组件文件**: PascalCase，如 `UserProfile.vue`
- **工具文件**: camelCase，如 `formatDate.ts`
- **类型文件**: camelCase，如 `userTypes.ts`

#### 6.1.2 变量命名
- **变量/函数**: camelCase，如 `userName`、`getUserInfo`
- **常量**: UPPER_SNAKE_CASE，如 `API_BASE_URL`
- **组件名**: PascalCase，如 `UserProfile`

### 6.2 代码规范

#### 6.2.1 组件规范
- 使用 `<script setup>` 语法
- 使用 TypeScript
- Props 和 Emits 使用 `defineProps` 和 `defineEmits`
- 使用组合式 API（Composition API）

#### 6.2.2 API 调用规范
- 所有 API 调用统一通过 `api/` 目录
- 使用 TypeScript 定义请求和响应类型
- 统一错误处理

#### 6.2.3 样式规范
- 使用 SCSS
- 使用 BEM 命名规范（如需要）
- 使用 CSS 变量管理主题色

---

## 七、构建与部署

### 7.1 开发环境

```bash
# 安装依赖
pnpm install

# 启动开发服务器
pnpm dev

# 代码检查
pnpm lint

# 代码格式化
pnpm format
```

### 7.2 生产构建

```bash
# 构建生产版本
pnpm build

# 预览生产构建
pnpm preview
```

### 7.3 部署

- **静态资源**: 构建后的 `dist/` 目录
- **部署方式**: Nginx、CDN、对象存储等
- **路由配置**: 需要配置 Nginx 支持 SPA 路由

---

## 八、后续扩展

### 8.1 功能扩展
- 国际化（i18n）
- 主题切换
- 暗色模式
- 多标签页
- 权限管理完善

### 8.2 性能优化
- 路由懒加载
- 组件懒加载
- 图片懒加载
- 虚拟滚动
- 代码分割

### 8.3 开发体验
- Mock 数据
- 开发工具
- 调试工具
- 性能监控

---

**文档版本**: v1.0  
**创建时间**: 2025-01-XX

