# Lumina 项目结构设计

## 一、Maven 多模块结构

```
lumina/
├── pom.xml                          # 根 POM（父 POM）
├── lumina-common/                   # 公共模块（仅作为依赖，不单独启动）
│   └── pom.xml
├── lumina-agent-core/               # Agent 核心模块（仅作为依赖，不单独启动）
│   └── pom.xml
├── lumina-framework/                # 框架基础设施模块（仅作为依赖，不单独启动）
│   └── pom.xml
├── lumina-gateway/                  # 网关模块（统一入口服务，可选但推荐）
│   └── pom.xml
└── lumina-modules/                  # 业务微服务聚合（可选）
    ├── pom.xml
    ├── lumina-business-{domain}/     # 传统业务微服务（按需，自带启动类）
    └── lumina-agent-{domain}/        # Agent 业务微服务（按需，自带启动类）
```

**说明**:
- 核心模块（common、agent-core、framework）**不包含启动类，只提供能力**
- 每个业务模块自带启动类，本身就是一个独立微服务，通过 Nacos 注册通信
- `lumina-gateway` 作为统一入口（API Gateway），转发到各业务微服务

---

## 二、根 POM 设计

### 2.1 基本信息

```xml
<groupId>io.lumina</groupId>
<artifactId>lumina</artifactId>
<version>1.0.0-SNAPSHOT</version>
<packaging>pom</packaging>
```

### 2.2 模块声明

```xml
<modules>
    <module>lumina-common</module>
    <module>lumina-agent-core</module>
    <module>lumina-framework</module>
    <module>lumina-gateway</module>
    <module>lumina-modules</module>
</modules>
```

**说明**: 业务微服务在 `lumina-modules` 下按需创建，Gateway 是单独模块

### 2.3 版本管理

统一管理依赖版本（参考技术选型方案）

---

## 三、模块目录结构

### 3.1 lumina-common

```
lumina-common/
├── pom.xml
└── src/main/java/io/lumina/common/
    ├── core/
    │   ├── R.java                    # 统一响应格式
    │   ├── PageResult.java           # 分页结果
    │   └── BaseEntity.java           # 基础实体
    ├── exception/
    │   ├── BaseException.java        # 基础异常
    │   ├── BusinessException.java    # 业务异常
    │   └── SystemException.java     # 系统异常
    ├── constant/
    │   └── Constants.java            # 常量定义
    └── utils/
        ├── StringUtils.java
        ├── DateUtils.java
        └── CollectionUtils.java
```

### 3.2 lumina-agent-core

```
lumina-agent-core/
├── pom.xml
└── src/main/java/io/lumina/agent/
    ├── core/
    │   ├── AgentExecutionEngine.java
    │   └── AgentBuilder.java
    ├── config/
    │   ├── ConfigLoader.java
    │   └── BusinessAgentConfig.java
    ├── prompt/
    │   ├── PromptLoader.java
    │   └── PromptTemplate.java
    ├── tool/
    │   ├── ToolManager.java
    │   └── ToolRegistry.java
    └── memory/
        └── MemoryManager.java
└── src/main/resources/
    └── agent-config/
        └── default.yaml              # 默认配置
```

### 3.3 lumina-framework

```
lumina-framework/
├── pom.xml
└── src/main/java/io/lumina/framework/
    ├── config/
    │   ├── MyBatisPlusConfig.java
    │   ├── RedisConfig.java
    │   └── JacksonConfig.java
    ├── web/
    │   ├── GlobalExceptionHandler.java
    │   └── WebMvcConfig.java
    └── aspect/
        └── LogAspect.java
```

### 3.4 lumina-gateway（网关模块）

```
lumina-gateway/
├── pom.xml
└── src/main/java/io/lumina/gateway/
    ├── LuminaGatewayApplication.java   # 网关启动类
    └── config/
        ├── GatewayConfig.java          # 路由、过滤器配置
        └── SecurityConfig.java         # 认证、鉴权（如需要）
└── src/main/resources/
    ├── application.yml                 # 网关配置（Nacos、路由、限流等）
    └── bootstrap.yml                   # Nacos 配置（注册中心、配置中心）
```

### 3.5 lumina-modules（业务模块聚合）

#### 3.5.1 lumina-business-order（传统业务模块示例）
#### 3.5.1 lumina-business-order（传统业务模块示例）

```
lumina-business-order/
├── pom.xml
└── src/main/java/io/lumina/business/order/
    ├── OrderApplication.java        # 启动类（可选，如需独立启动）
    ├── api/
    │   ├── controller/
    │   └── dto/
    ├── service/
    │   ├── OrderService.java
    │   └── impl/
    ├── domain/
    │   ├── model/
    │   └── enums/
    └── infrastructure/
        ├── mapper/
        ├── entity/
        └── converter/
└── src/main/resources/
    ├── application.yml
    └── bootstrap.yml                 # Nacos 配置（微服务模式）
```

#### 3.5.2 lumina-agent-customer（Agent 业务模块示例）

```
lumina-agent-customer/
├── pom.xml
└── src/main/java/io/lumina/agent/customer/
    ├── CustomerAgentApplication.java # 启动类（可选，如需独立启动）
    ├── service/
    │   └── CustomerAgentService.java
    └── api/
        └── CustomerAgentController.java
└── src/main/resources/
    ├── application.yml
    ├── bootstrap.yml                 # Nacos 配置（微服务模式）
    ├── agent-config/
    │   └── customer-service.yaml
    └── prompt/
        └── customer-service.md
```

---

## 四、依赖关系

### 4.1 模块依赖图

```
lumina-common (基础)
    ↑
    ├── lumina-agent-core (依赖 common)
    ├── lumina-framework (依赖 common)
    └── lumina-modules (依赖 common, framework)
        ├── lumina-business-xxx (依赖 common, framework)
        │   └── 自带启动类（可选）
        └── lumina-agent-xxx (依赖 common, agent-core, framework)
            └── 自带启动类（可选）
```

### 4.2 依赖配置示例

```xml
<!-- lumina-agent-core/pom.xml -->
<dependencies>
    <dependency>
        <groupId>io.lumina</groupId>
        <artifactId>lumina-common</artifactId>
    </dependency>
    <!-- AgentScope 等依赖 -->
</dependencies>
```

---

## 五、配置文件结构

### 5.1 各业务模块的 application.yml

```yaml
spring:
  application:
    name: lumina-business-order    # 每个业务模块有自己的服务名，如 lumina-business-order
  profiles:
    active: dev

# MyBatis-Plus
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
  global-config:
    db-config:
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0

# Redis
spring:
  data:
    redis:
      host: localhost
      port: 6379

# Nacos 注册中心（微服务必须）
spring:
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
      config:
        server-addr: localhost:8848
        group: LUMINA_GROUP
        namespace: default
```

---

## 六、基础类设计（简要）

### 6.1 统一响应 R<T>

```java
@Data
public class R<T> {
    private Integer code;
    private String msg;
    private T data;
    private Long timestamp;
    
    public static <T> R<T> success(T data) { ... }
    public static <T> R<T> fail(Integer code, String msg) { ... }
}
```

### 6.2 异常体系

```java
// BaseException
// BusinessException
// SystemException
```

---

## 七、启动方式

### 7.1 业务模块独立启动（推荐）

每个业务模块自带启动类，本身就是一个独立微服务，通过 Nacos 进行注册和通信。

```java
// lumina-business-order/src/main/java/.../OrderApplication.java
@SpringBootApplication
public class OrderApplication {
    public static void main(String[] args) {
        SpringApplication.run(OrderApplication.class, args);
    }
}
```

**启动命令**:
```bash
# 启动订单业务模块
java -jar lumina-business-order/target/lumina-business-order.jar

# 启动客服 Agent 模块
java -jar lumina-agent-customer/target/lumina-agent-customer.jar
```

### 7.2 开发环境运行方式

- 可以只启动某一个或少量业务模块（例如先启动 `lumina-business-order`）
- 所有业务模块依赖相同的核心模块（common、agent-core、framework）
- 即使在本地开发环境，每个业务模块依然按照微服务方式运行，通过 Nacos 发现和调用

### 7.3 生产环境运行方式

- 各业务模块作为独立微服务部署
- 必须通过 Nacos / Spring Cloud 进行服务注册与发现
- 如有需要，可增加 `lumina-gateway` 网关模块作为统一入口（可选，后续设计）

---

**文档版本**: v1.0  
**创建时间**: 2025-01-XX

