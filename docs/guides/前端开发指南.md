# Lumina 前端开发指南

## 一、开发环境准备

### 1.1 环境要求

- **Node.js**: 18.0+ (推荐使用 LTS 版本)
- **包管理器**: pnpm 8.0+ (推荐) 或 npm 9.0+ / yarn 1.22+
- **IDE**: VS Code (推荐) 或 WebStorm
- **浏览器**: Chrome 90+ / Firefox 88+ / Edge 90+

### 1.2 开发工具推荐

#### VS Code 插件
- **Volar** - Vue 3 官方推荐插件
- **TypeScript Vue Plugin (Volar)** - TypeScript 支持
- **ESLint** - 代码检查
- **Prettier** - 代码格式化
- **Stylelint** - CSS 代码检查
- **Auto Rename Tag** - 自动重命名标签
- **Path Intellisense** - 路径自动补全

### 1.3 项目初始化

```bash
# 使用 Vite 创建 Vue 3 + TypeScript 项目
pnpm create vite lumina-frontend --template vue-ts

# 进入项目目录
cd lumina-frontend

# 安装依赖
pnpm install

# 安装核心依赖
pnpm add vue@^3.4 vue-router@^4.2 pinia@^2.1
pnpm add axios@^1.6 element-plus@^2.5 @element-plus/icons-vue@^2.3
pnpm add dayjs@^1.11 nprogress@^0.2

# 安装开发依赖
pnpm add -D @vitejs/plugin-vue sass@^1.69
pnpm add -D eslint@^8.57 prettier@^3.2 stylelint@^16.0
pnpm add -D @types/node @types/nprogress
```

---

## 二、项目结构搭建

### 2.1 创建目录结构

按照 `前端架构设计.md` 中的目录结构创建所有必要的目录：

```bash
# 创建主要目录
mkdir -p src/api/modules
mkdir -p src/assets/{images,icons,styles}
mkdir -p src/components/{common,business}
mkdir -p src/composables
mkdir -p src/directives
mkdir -p src/layouts/components
mkdir -p src/router/modules
mkdir -p src/stores/modules
mkdir -p src/types
mkdir -p src/utils
mkdir -p src/views/{agent,user,system}
```

### 2.2 创建核心文件

#### 2.2.1 入口文件

```typescript
// src/main.ts
import { createApp } from 'vue'
import App from './App.vue'
import router from './router'
import { createPinia } from 'pinia'
import ElementPlus from 'element-plus'
import 'element-plus/dist/index.css'
import * as ElementPlusIconsVue from '@element-plus/icons-vue'
import '@/assets/styles/index.scss'

const app = createApp(App)

// 注册 Element Plus 图标
for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
  app.component(key, component)
}

app.use(createPinia())
app.use(router)
app.use(ElementPlus)

app.mount('#app')
```

#### 2.2.2 根组件

```vue
<!-- src/App.vue -->
<template>
  <router-view />
</template>

<script setup lang="ts">
// 根组件逻辑
</script>
```

---

## 三、核心功能开发

### 3.1 HTTP 请求封装

参考 `前端架构设计.md` 中的 HTTP 请求封装部分，创建 `src/api/request.ts`。

**关键点**:
- 统一请求和响应拦截器
- Token 自动添加
- 统一错误处理
- 401 自动跳转登录

### 3.2 路由配置

#### 3.2.1 基础路由

```typescript
// src/router/modules/agent.ts
import type { RouteRecordRaw } from 'vue-router'

const agentRoutes: RouteRecordRaw[] = [
  {
    path: '/agent',
    name: 'Agent',
    meta: {
      title: 'Agent 管理',
      icon: 'Agent',
      requiresAuth: true
    },
    children: [
      {
        path: 'list',
        name: 'AgentList',
        component: () => import('@/views/agent/index.vue'),
        meta: {
          title: 'Agent 列表',
          requiresAuth: true
        }
      },
      {
        path: 'detail/:id',
        name: 'AgentDetail',
        component: () => import('@/views/agent/detail.vue'),
        meta: {
          title: 'Agent 详情',
          requiresAuth: true
        }
      }
    ]
  }
]

export default agentRoutes
```

#### 3.2.2 路由注册

```typescript
// src/router/index.ts
import { createRouter, createWebHistory } from 'vue-router'
import type { RouteRecordRaw } from 'vue-router'
import agentRoutes from './modules/agent'
import { setupRouterGuards } from './guards'

const routes: RouteRecordRaw[] = [
  {
    path: '/',
    redirect: '/agent/list'
  },
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/views/login/index.vue'),
    meta: {
      title: '登录',
      requiresAuth: false
    }
  },
  {
    path: '/',
    component: () => import('@/layouts/DefaultLayout.vue'),
    children: [
      ...agentRoutes
    ]
  }
]

const router = createRouter({
  history: createWebHistory(),
  routes
})

setupRouterGuards(router)

export default router
```

### 3.3 状态管理

参考 `前端架构设计.md` 中的状态管理部分，创建用户状态和应用状态 Store。

### 3.4 布局组件

#### 3.4.1 默认布局

```vue
<!-- src/layouts/DefaultLayout.vue -->
<template>
  <div class="layout-container">
    <AppHeader />
    <div class="layout-content">
      <AppSidebar />
      <div class="layout-main">
        <AppBreadcrumb />
        <div class="layout-page">
          <router-view />
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import AppHeader from './components/AppHeader.vue'
import AppSidebar from './components/AppSidebar.vue'
import AppBreadcrumb from './components/AppBreadcrumb.vue'
</script>
```

---

## 四、页面开发示例

### 4.1 列表页开发

```vue
<!-- src/views/agent/index.vue -->
<template>
  <div class="agent-list-page">
    <PageHeader title="Agent 列表">
      <el-button type="primary" @click="handleCreate">
        <el-icon><Plus /></el-icon>
        新建 Agent
      </el-button>
    </PageHeader>
    
    <el-card>
      <el-form :model="queryForm" inline>
        <el-form-item label="Agent 名称">
          <el-input v-model="queryForm.agentName" placeholder="请输入" clearable />
        </el-form-item>
        <el-form-item label="类型">
          <el-select v-model="queryForm.agentType" placeholder="请选择" clearable>
            <el-option label="类型1" value="type1" />
            <el-option label="类型2" value="type2" />
          </el-select>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="loadData">查询</el-button>
          <el-button @click="handleReset">重置</el-button>
        </el-form-item>
      </el-form>
      
      <el-table :data="tableData" v-loading="loading" border>
        <el-table-column prop="agentName" label="Agent 名称" />
        <el-table-column prop="agentType" label="类型" />
        <el-table-column prop="status" label="状态">
          <template #default="{ row }">
            <el-tag :type="row.status === 1 ? 'success' : 'info'">
              {{ row.status === 1 ? '启用' : '禁用' }}
            </el-tag>
          </template>
        </el-table-column>
        <el-table-column prop="createTime" label="创建时间" />
        <el-table-column label="操作" width="200">
          <template #default="{ row }">
            <el-button link type="primary" @click="handleEdit(row)">编辑</el-button>
            <el-button link type="danger" @click="handleDelete(row)">删除</el-button>
          </template>
        </el-table-column>
      </el-table>
      
      <el-pagination
        v-model:current-page="pagination.pageNum"
        v-model:page-size="pagination.pageSize"
        :total="pagination.total"
        :page-sizes="[10, 20, 50, 100]"
        layout="total, sizes, prev, pager, next, jumper"
        @size-change="handleSizeChange"
        @current-change="handlePageChange"
      />
    </el-card>
    
    <!-- 创建/编辑对话框 -->
    <AgentDialog
      v-model="dialogVisible"
      :agent-id="currentAgentId"
      @success="loadData"
    />
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, onMounted } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import { Plus } from '@element-plus/icons-vue'
import { listAgents, deleteAgent, type AgentVO } from '@/api/modules/agent'
import { useTable } from '@/composables/useTable'
import PageHeader from '@/components/common/PageHeader.vue'
import AgentDialog from './components/AgentDialog.vue'

const queryForm = reactive({
  agentName: '',
  agentType: ''
})

const { loading, tableData, pagination, loadData, handlePageChange, handleSizeChange } = useTable<AgentVO>(
  (params) => listAgents({ ...queryForm, ...params })
)

const dialogVisible = ref(false)
const currentAgentId = ref<number | null>(null)

const handleCreate = () => {
  currentAgentId.value = null
  dialogVisible.value = true
}

const handleEdit = (row: AgentVO) => {
  currentAgentId.value = row.agentId
  dialogVisible.value = true
}

const handleDelete = async (row: AgentVO) => {
  try {
    await ElMessageBox.confirm('确定要删除该 Agent 吗？', '提示', {
      type: 'warning'
    })
    await deleteAgent(row.agentId)
    ElMessage.success('删除成功')
    loadData()
  } catch (error) {
    // 用户取消或删除失败
  }
}

const handleReset = () => {
  queryForm.agentName = ''
  queryForm.agentType = ''
  loadData()
}

onMounted(() => {
  loadData()
})
</script>
```

### 4.2 表单组件开发

```vue
<!-- src/views/agent/components/AgentDialog.vue -->
<template>
  <el-dialog
    v-model="visible"
    :title="agentId ? '编辑 Agent' : '新建 Agent'"
    width="600px"
    @close="handleClose"
  >
    <el-form
      ref="formRef"
      :model="formData"
      :rules="formRules"
      label-width="100px"
    >
      <el-form-item label="Agent 名称" prop="agentName">
        <el-input v-model="formData.agentName" placeholder="请输入 Agent 名称" />
      </el-form-item>
      <el-form-item label="类型" prop="agentType">
        <el-select v-model="formData.agentType" placeholder="请选择类型">
          <el-option label="类型1" value="type1" />
          <el-option label="类型2" value="type2" />
        </el-select>
      </el-form-item>
      <el-form-item label="描述" prop="description">
        <el-input
          v-model="formData.description"
          type="textarea"
          :rows="4"
          placeholder="请输入描述"
        />
      </el-form-item>
    </el-form>
    
    <template #footer>
      <el-button @click="handleClose">取消</el-button>
      <el-button type="primary" @click="handleSubmit" :loading="submitting">
        确定
      </el-button>
    </template>
  </el-dialog>
</template>

<script setup lang="ts">
import { ref, reactive, watch } from 'vue'
import { ElMessage, type FormInstance, type FormRules } from 'element-plus'
import { createAgent, updateAgent, getAgent, type CreateAgentDTO } from '@/api/modules/agent'

interface Props {
  modelValue: boolean
  agentId?: number | null
}

const props = withDefaults(defineProps<Props>(), {
  modelValue: false,
  agentId: null
})

const emit = defineEmits<{
  'update:modelValue': [value: boolean]
  'success': []
}>()

const formRef = ref<FormInstance>()
const submitting = ref(false)

const formData = reactive<CreateAgentDTO>({
  agentName: '',
  agentType: '',
  description: ''
})

const formRules: FormRules = {
  agentName: [
    { required: true, message: '请输入 Agent 名称', trigger: 'blur' }
  ],
  agentType: [
    { required: true, message: '请选择类型', trigger: 'change' }
  ]
}

const visible = computed({
  get: () => props.modelValue,
  set: (val) => emit('update:modelValue', val)
})

// 加载 Agent 详情
const loadAgentDetail = async () => {
  if (!props.agentId) return
  
  try {
    const res = await getAgent(props.agentId)
    Object.assign(formData, res.data)
  } catch (error) {
    ElMessage.error('加载 Agent 详情失败')
  }
}

// 监听 agentId 变化
watch(() => props.agentId, (newId) => {
  if (newId) {
    loadAgentDetail()
  } else {
    resetForm()
  }
}, { immediate: true })

// 监听对话框显示
watch(() => props.modelValue, (val) => {
  if (val && props.agentId) {
    loadAgentDetail()
  } else if (val) {
    resetForm()
  }
})

const resetForm = () => {
  formData.agentName = ''
  formData.agentType = ''
  formData.description = ''
  formRef.value?.clearValidate()
}

const handleClose = () => {
  visible.value = false
  resetForm()
}

const handleSubmit = async () => {
  if (!formRef.value) return
  
  await formRef.value.validate(async (valid) => {
    if (!valid) return
    
    submitting.value = true
    try {
      if (props.agentId) {
        await updateAgent(props.agentId, formData)
        ElMessage.success('更新成功')
      } else {
        await createAgent(formData)
        ElMessage.success('创建成功')
      }
      emit('success')
      handleClose()
    } catch (error) {
      // 错误已在 request.ts 中处理
    } finally {
      submitting.value = false
    }
  })
}
</script>
```

---

## 五、公共组件开发

### 5.1 页面头部组件

```vue
<!-- src/components/common/PageHeader.vue -->
<template>
  <div class="page-header">
    <div class="page-header-title">
      <slot name="title">{{ title }}</slot>
    </div>
    <div class="page-header-actions">
      <slot />
    </div>
  </div>
</template>

<script setup lang="ts">
interface Props {
  title?: string
}

withDefaults(defineProps<Props>(), {
  title: ''
})
</script>

<style scoped lang="scss">
.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
  
  .page-header-title {
    font-size: 20px;
    font-weight: 500;
  }
}
</style>
```

### 5.2 表格组件封装

```vue
<!-- src/components/common/PageTable.vue -->
<template>
  <el-table
    v-bind="$attrs"
    :data="tableData"
    v-loading="loading"
    border
  >
    <slot />
  </el-table>
</template>

<script setup lang="ts">
interface Props {
  tableData: any[]
  loading?: boolean
}

withDefaults(defineProps<Props>(), {
  loading: false
})
</script>
```

---

## 六、开发规范

### 6.1 组件开发规范

1. **使用 `<script setup>` 语法**
2. **使用 TypeScript**
3. **Props 和 Emits 使用 `defineProps` 和 `defineEmits`**
4. **组件名使用 PascalCase**
5. **单文件组件文件名使用 PascalCase**

### 6.2 API 调用规范

1. **所有 API 调用统一通过 `api/` 目录**
2. **使用 TypeScript 定义请求和响应类型**
3. **统一错误处理（在 request.ts 中）**
4. **使用 async/await 处理异步**

### 6.3 样式规范

1. **使用 SCSS**
2. **使用 `<style scoped>` 避免样式污染**
3. **使用 CSS 变量管理主题色**
4. **遵循 BEM 命名规范（如需要）**

### 6.4 代码质量

1. **使用 ESLint 进行代码检查**
2. **使用 Prettier 进行代码格式化**
3. **提交前运行 `pnpm lint` 检查代码**
4. **遵循 TypeScript 严格模式**

---

## 七、常见问题

### 7.1 类型定义问题

**问题**: TypeScript 类型错误
- **解决方案**: 确保所有类型定义正确，使用 `type` 或 `interface` 定义类型

### 7.2 路由问题

**问题**: 路由跳转不生效
- **解决方案**: 检查路由配置，确保路径正确，检查路由守卫

### 7.3 API 调用问题

**问题**: API 请求失败
- **解决方案**: 检查请求拦截器，检查 Token 是否正确，检查后端接口是否正常

### 7.4 样式问题

**问题**: 样式不生效
- **解决方案**: 检查 scoped 属性，检查样式优先级，检查 CSS 变量

---

## 八、最佳实践

### 8.1 性能优化

1. **路由懒加载**: 使用动态 import
2. **组件懒加载**: 大组件使用异步组件
3. **图片懒加载**: 使用 `v-lazy` 指令
4. **虚拟滚动**: 大数据列表使用虚拟滚动

### 8.2 代码复用

1. **使用 Composables**: 封装可复用的逻辑
2. **使用公共组件**: 提取公共 UI 组件
3. **使用工具函数**: 提取公共工具函数

### 8.3 错误处理

1. **统一错误处理**: 在 request.ts 中统一处理
2. **用户友好提示**: 使用 ElMessage 提示用户
3. **错误日志**: 记录错误日志便于排查

---

**文档版本**: v1.0  
**创建时间**: 2025-01-XX

