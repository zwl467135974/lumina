# Lumina 项目搭建执行计划

## 一、执行计划概述

### 1.1 目标
搭建 Lumina 框架的基础架构，包括：
- Maven 多模块项目结构
- 核心模块（common、agent-core、framework、gateway）
- 基础代码框架（统一响应、异常体系、配置类）
- 配置文件模板
- 开发环境验证

### 1.2 执行原则
1. **分阶段执行** - 按模块顺序逐步搭建
2. **先核心后业务** - 先搭建核心模块，再搭建业务模块示例
3. **验证驱动** - 每个阶段完成后进行验证
4. **文档同步** - 关键步骤记录在文档中

### 1.3 预计工作量
- **阶段一（项目初始化）**: 1-2 小时
- **阶段二（核心模块）**: 4-6 小时
- **阶段三（业务模块示例）**: 2-3 小时
- **阶段四（配置与验证）**: 1-2 小时
- **总计**: 8-13 小时

---

## 二、阶段一：项目初始化

### 2.1 任务清单

| 任务编号 | 任务名称 | 优先级 | 预计时间 |
|---------|---------|--------|---------|
| T1.1 | 创建项目根目录结构 | P0 | 10分钟 |
| T1.2 | 创建根 POM 文件 | P0 | 30分钟 |
| T1.3 | 创建各模块目录结构 | P0 | 20分钟 |
| T1.4 | 配置 Git 仓库（可选） | P1 | 10分钟 |

### 2.2 详细执行步骤

#### T1.1 创建项目根目录结构

**目标**: 创建 Lumina 项目的根目录和基础结构

**步骤**:
1. 在 `workHub` 目录下创建 `lumina` 项目根目录（如果不存在）
2. 创建以下目录结构：
   ```
   lumina/
   ├── .gitignore
   ├── README.md
   ├── pom.xml
   ├── lumina-common/
   ├── lumina-agent-core/
   ├── lumina-framework/
   ├── lumina-gateway/
   └── lumina-modules/
   ```

**验证点**:
- [ ] 根目录结构已创建
- [ ] 所有模块目录已创建

**注意事项**:
- 确保目录名称与设计文档一致
- 注意大小写（lumina 全小写）

---

#### T1.2 创建根 POM 文件

**目标**: 创建父 POM，统一管理依赖版本和模块

**步骤**:
1. 在 `lumina/pom.xml` 中定义：
   - 基本信息（groupId、artifactId、version、packaging）
   - Java 版本（21）
   - 模块声明（modules）
   - 属性管理（properties）- 统一版本号
   - 依赖管理（dependencyManagement）- 所有依赖版本
   - 构建配置（build）- Maven 编译配置

2. **关键配置项**:
   ```xml
   <groupId>io.lumina</groupId>
   <artifactId>lumina</artifactId>
   <version>1.0.0-SNAPSHOT</version>
   <packaging>pom</packaging>
   
   <modules>
       <module>lumina-common</module>
       <module>lumina-agent-core</module>
       <module>lumina-framework</module>
       <module>lumina-gateway</module>
       <module>lumina-modules</module>
   </modules>
   ```

3. **版本管理**（参考技术选型方案）:
   - Spring Boot: 3.3.5
   - Spring Cloud: 2023.0.3
   - Spring Cloud Alibaba: 2023.0.1.2
   - Java: 21
   - MyBatis: 3.0.3
   - MyBatis-Plus: 3.5.7
   - AgentScope Java: 1.0.7
   - Redis/Redisson: 3.24.3
   - Nacos: 3.1.1+
   - Jackson: 2.20.1
   - 其他依赖版本...

**验证点**:
- [ ] POM 文件语法正确
- [ ] 所有模块已声明
- [ ] 版本号统一管理
- [ ] Maven 可以正常解析（`mvn validate`）

**注意事项**:
- 使用 `<dependencyManagement>` 统一管理版本，子模块只需声明依赖，无需指定版本
- 注意 Java 21 的编译配置（`<maven.compiler.source>` 和 `<maven.compiler.target>`）
- AgentScope Java 1.0.7 可能需要特殊处理（Java 版本兼容）

---

#### T1.3 创建各模块目录结构

**目标**: 为每个模块创建标准的 Maven 目录结构

**步骤**:
1. 为每个模块创建以下目录结构：
   ```
   lumina-{module}/
   ├── pom.xml
   └── src/
       ├── main/
       │   ├── java/
       │   │   └── io/lumina/...
       │   └── resources/
       │       └── application.yml (如需要)
       └── test/
           └── java/
   ```

2. **模块列表**:
   - `lumina-common`
   - `lumina-agent-core`
   - `lumina-framework`
   - `lumina-gateway`
   - `lumina-modules` (聚合模块，内部包含业务模块)

**验证点**:
- [ ] 所有模块的目录结构已创建
- [ ] 包路径符合规范（`io.lumina.*`）

**注意事项**:
- 核心模块（common、agent-core、framework）不包含启动类
- Gateway 模块需要启动类
- 业务模块在 `lumina-modules` 下按需创建

---

#### T1.4 配置 Git 仓库（可选）

**目标**: 初始化 Git 仓库，配置 .gitignore

**步骤**:
1. 在项目根目录执行 `git init`
2. 创建 `.gitignore` 文件，包含：
   - Maven 相关（`target/`、`.mvn/`）
   - IDE 相关（`.idea/`、`.vscode/`、`*.iml`）
   - 系统文件（`.DS_Store`、`Thumbs.db`）
   - 日志文件（`*.log`）
   - 配置文件中的敏感信息（如需要）

**验证点**:
- [ ] Git 仓库已初始化
- [ ] .gitignore 配置正确

---

## 三、阶段二：核心模块搭建

### 3.1 任务清单

| 任务编号 | 任务名称 | 优先级 | 预计时间 |
|---------|---------|--------|---------|
| T2.1 | 搭建 lumina-common 模块 | P0 | 1小时 |
| T2.2 | 搭建 lumina-framework 模块 | P0 | 1.5小时 |
| T2.3 | 搭建 lumina-agent-core 模块 | P0 | 2小时 |
| T2.4 | 搭建 lumina-gateway 模块 | P1 | 1小时 |

### 3.2 详细执行步骤

#### T2.1 搭建 lumina-common 模块

**目标**: 创建公共组件模块，提供统一响应、异常体系、工具类

**步骤**:

1. **创建模块 POM** (`lumina-common/pom.xml`):
   - 继承父 POM
   - 添加基础依赖（Lombok、Spring Boot Starter、Jackson）

2. **创建统一响应类** (`R.java`):
   ```java
   package io.lumina.common.core;
   
   @Data
   public class R<T> {
       private Integer code;
       private String msg;
       private T data;
       private Long timestamp;
       
       public static <T> R<T> success(T data) { ... }
       public static <T> R<T> fail(Integer code, String msg) { ... }
   }
   ```

3. **创建分页结果类** (`PageResult.java`):
   ```java
   package io.lumina.common.core;
   
   @Data
   public class PageResult<T> {
       private List<T> list;
       private Long total;
       private Integer pageNum;
       private Integer pageSize;
       private Integer pages;
   }
   ```

4. **创建异常体系**:
   - `BaseException.java` - 基础异常
   - `BusinessException.java` - 业务异常
   - `SystemException.java` - 系统异常

5. **创建工具类**:
   - `StringUtils.java` - 字符串工具
   - `DateUtils.java` - 日期工具
   - `CollectionUtils.java` - 集合工具

6. **创建常量类** (`Constants.java`):
   - 通用常量定义

**验证点**:
- [ ] 模块可以正常编译（`mvn clean compile`）
- [ ] 所有类符合命名规范
- [ ] 统一响应格式符合接口规范

**注意事项**:
- 统一响应格式参考 `Lumina开发规范与编码标准.md`
- 异常体系要清晰，便于全局异常处理
- 工具类避免重复造轮子，优先使用 Apache Commons 或 Guava

---

#### T2.2 搭建 lumina-framework 模块

**目标**: 创建框架基础设施模块，提供配置类、全局异常处理、Web 配置

**步骤**:

1. **创建模块 POM** (`lumina-framework/pom.xml`):
   - 依赖 `lumina-common`
   - 添加 Spring Boot Web、MyBatis-Plus、Redis、Jackson 等依赖

2. **创建 MyBatis-Plus 配置** (`MyBatisPlusConfig.java`):
   - 配置分页插件
   - 配置逻辑删除
   - 配置自动填充（创建时间、更新时间）

3. **创建 Redis 配置** (`RedisConfig.java`):
   - 配置 Redisson 客户端
   - 配置 Redis 序列化方式（Jackson）

4. **创建 Jackson 配置** (`JacksonConfig.java`):
   - 统一 JSON 序列化配置
   - 日期格式配置
   - 空值处理配置

5. **创建全局异常处理** (`GlobalExceptionHandler.java`):
   - 处理业务异常
   - 处理系统异常
   - 处理参数校验异常
   - 统一返回格式

6. **创建 Web 配置** (`WebMvcConfig.java`):
   - 跨域配置
   - 拦截器配置（如需要）
   - 消息转换器配置

7. **创建日志切面** (`LogAspect.java`)（可选）:
   - AOP 日志记录

**验证点**:
- [ ] 模块可以正常编译
- [ ] 配置类可以正常加载
- [ ] 全局异常处理生效

**注意事项**:
- MyBatis-Plus 配置参考开发规范文档
- Redis 配置使用 Redisson，注意序列化方式
- Jackson 配置要统一，避免与 Fastjson2 混用

---

#### T2.3 搭建 lumina-agent-core 模块

**目标**: 创建 Agent 执行引擎核心模块，封装 AgentScope 能力

**步骤**:

1. **创建模块 POM** (`lumina-agent-core/pom.xml`):
   - 依赖 `lumina-common`
   - 添加 AgentScope Java 1.0.7 依赖
   - 添加 Project Reactor 依赖
   - 添加 LLM SDK 依赖（DashScope、OpenAI 等）

2. **创建核心接口** (`AgentExecutionEngine.java`):
   ```java
   public interface AgentExecutionEngine {
       Mono<ExecuteResult> execute(
           String businessType, 
           String task, 
           AgentConfig config
       );
   }
   ```

3. **创建配置加载器** (`ConfigLoader.java`):
   - 加载业务 Agent 配置
   - 支持 YAML/JSON 格式
   - 配置优先级处理

4. **创建提示词加载器** (`PromptLoader.java`):
   - 加载提示词模板
   - 支持模板变量替换

5. **创建工具管理器** (`ToolManager.java`):
   - 工具注册
   - 工具发现
   - 工具调用

6. **创建记忆管理器** (`MemoryManager.java`):
   - 记忆存储
   - 记忆检索

7. **创建 Agent 构建器** (`AgentBuilder.java`):
   - 根据配置构建 Agent 实例
   - 集成 AgentScope

8. **创建默认配置** (`src/main/resources/agent-config/default.yaml`):
   - 默认 Agent 配置模板

**验证点**:
- [ ] 模块可以正常编译
- [ ] AgentScope 依赖可以正常解析
- [ ] 核心接口设计符合模块设计文档

**注意事项**:
- AgentScope Java 1.0.7 使用 Java 17，需要验证 Java 21 兼容性
- 注意响应式编程（Project Reactor）的使用
- 配置加载要支持多环境（dev、test、prod）

---

#### T2.4 搭建 lumina-gateway 模块

**目标**: 创建 API 网关模块，作为统一入口

**步骤**:

1. **创建模块 POM** (`lumina-gateway/pom.xml`):
   - 依赖 `lumina-common`、`lumina-framework`
   - 添加 Spring Cloud Gateway 依赖
   - 添加 Nacos Discovery 依赖

2. **创建启动类** (`LuminaGatewayApplication.java`):
   ```java
   @SpringBootApplication
   @EnableDiscoveryClient
   public class LuminaGatewayApplication {
       public static void main(String[] args) {
           SpringApplication.run(LuminaGatewayApplication.class, args);
       }
   }
   ```

3. **创建网关配置** (`GatewayConfig.java`):
   - 路由配置
   - 过滤器配置
   - 限流配置（如需要）

4. **创建安全配置** (`SecurityConfig.java`)（可选）:
   - 认证配置
   - 鉴权配置

5. **创建配置文件** (`application.yml`):
   - 服务注册配置（Nacos）
   - 路由配置
   - 限流配置

**验证点**:
- [ ] 模块可以正常编译
- [ ] 启动类可以正常启动（需要 Nacos 运行）
- [ ] 路由配置正确

**注意事项**:
- Gateway 需要 Nacos 服务注册中心
- 路由配置要支持动态路由（从 Nacos 配置中心读取）
- 注意跨域配置

---

## 四、阶段三：业务模块示例

### 4.1 任务清单

| 任务编号 | 任务名称 | 优先级 | 预计时间 |
|---------|---------|--------|---------|
| T3.1 | 创建 lumina-modules 聚合模块 | P0 | 20分钟 |
| T3.2 | 创建示例业务模块（可选） | P2 | 1.5小时 |

### 4.2 详细执行步骤

#### T3.1 创建 lumina-modules 聚合模块

**目标**: 创建业务模块聚合 POM，用于管理业务模块

**步骤**:

1. **创建模块 POM** (`lumina-modules/pom.xml`):
   - 继承父 POM
   - 声明为聚合模块（`<packaging>pom</packaging>`）
   - 声明子模块（业务模块按需添加）

2. **初始子模块**（可选，仅作为示例）:
   - `lumina-business-order` - 订单业务模块示例
   - `lumina-agent-customer` - 客服 Agent 模块示例

**验证点**:
- [ ] 聚合模块可以正常解析
- [ ] 子模块结构正确

**注意事项**:
- 业务模块按需创建，不在初始搭建中强制创建
- 子模块需要依赖核心模块（common、framework、agent-core）

---

#### T3.2 创建示例业务模块（可选）

**目标**: 创建一个完整的业务模块示例，验证架构设计

**步骤**:

1. **创建传统业务模块示例** (`lumina-business-order`):
   - 创建模块 POM（依赖 common、framework）
   - 创建标准分层结构（api、service、domain、infrastructure）
   - 创建示例实体、Service、Controller
   - 创建示例 Mapper 和 DO
   - 创建配置文件

2. **创建 Agent 业务模块示例** (`lumina-agent-customer`):
   - 创建模块 POM（依赖 common、agent-core、framework）
   - 创建 Agent 服务封装
   - 创建业务配置（YAML）
   - 创建提示词模板
   - 创建工具类（如需要）

**验证点**:
- [ ] 业务模块可以正常编译
- [ ] 分层结构符合开发规范
- [ ] 可以正常启动（需要数据库、Redis、Nacos）

**注意事项**:
- 示例模块仅用于验证架构，不包含完整业务逻辑
- 注意分层职责，避免跨层调用
- 配置文件要支持多环境

---

## 五、阶段四：配置与验证

### 5.1 任务清单

| 任务编号 | 任务名称 | 优先级 | 预计时间 |
|---------|---------|--------|---------|
| T4.1 | 配置开发环境 | P0 | 30分钟 |
| T4.2 | 编译验证 | P0 | 20分钟 |
| T4.3 | 启动验证 | P0 | 30分钟 |
| T4.4 | 文档整理 | P1 | 20分钟 |

### 5.2 详细执行步骤

#### T4.1 配置开发环境

**目标**: 配置开发环境所需的基础设施

**步骤**:

1. **数据库配置**:
   - 安装 MySQL 8.0+
   - 创建数据库（如 `lumina_dev`）
   - 配置连接信息

2. **Redis 配置**:
   - 安装 Redis 7.0+
   - 配置连接信息

3. **Nacos 配置**:
   - 安装 Nacos 3.1.1+
   - 启动 Nacos Server
   - 配置命名空间（dev、test、prod）

4. **环境变量配置**:
   - 配置 LLM API Key（如需要）
   - 配置其他环境变量

**验证点**:
- [ ] 数据库可以正常连接
- [ ] Redis 可以正常连接
- [ ] Nacos 可以正常访问（http://localhost:8848/nacos）

**注意事项**:
- 开发环境可以使用 Docker 快速搭建
- 注意配置文件中的敏感信息（使用环境变量或配置中心）

---

#### T4.2 编译验证

**目标**: 验证所有模块可以正常编译

**步骤**:

1. **清理编译**:
   ```bash
   mvn clean compile
   ```

2. **检查编译错误**:
   - 修复依赖问题
   - 修复语法错误
   - 修复包路径问题

3. **打包验证**:
   ```bash
   mvn clean package -DskipTests
   ```

**验证点**:
- [ ] 所有模块编译成功
- [ ] 无编译错误和警告
- [ ] 打包成功

**注意事项**:
- 首次编译可能需要下载大量依赖，需要时间
- 注意 Java 版本（必须使用 Java 21）
- 注意 Maven 版本（建议 3.9+）

---

#### T4.3 启动验证

**目标**: 验证核心模块和 Gateway 可以正常启动

**步骤**:

1. **启动 Nacos**:
   - 确保 Nacos Server 运行
   - 访问 Nacos 控制台验证

2. **启动 Gateway**:
   - 运行 `LuminaGatewayApplication`
   - 验证服务注册到 Nacos
   - 验证 Gateway 路由配置

3. **启动业务模块**（如已创建）:
   - 运行业务模块启动类
   - 验证服务注册
   - 验证接口调用

**验证点**:
- [ ] Gateway 可以正常启动
- [ ] 服务可以注册到 Nacos
- [ ] 接口可以正常访问（如已创建）

**注意事项**:
- 启动前确保数据库、Redis、Nacos 已启动
- 注意端口冲突
- 查看启动日志，确认无错误

---

#### T4.4 文档整理

**目标**: 整理项目文档，补充搭建说明

**步骤**:

1. **更新 README.md**:
   - 项目介绍
   - 快速开始
   - 模块说明
   - 开发指南

2. **创建搭建日志**:
   - 记录搭建过程中的问题和解决方案
   - 记录配置要点

3. **补充开发文档**:
   - 环境配置说明
   - 常见问题解答

**验证点**:
- [ ] README 文档完整
- [ ] 搭建日志已记录

---

## 六、执行检查清单

### 6.1 项目结构检查

- [ ] 根目录结构正确
- [ ] 所有模块目录已创建
- [ ] 包路径符合规范（`io.lumina.*`）

### 6.2 依赖配置检查

- [ ] 根 POM 配置正确
- [ ] 所有模块 POM 配置正确
- [ ] 依赖版本统一管理
- [ ] 无依赖冲突

### 6.3 代码框架检查

- [ ] 统一响应格式已实现
- [ ] 异常体系已实现
- [ ] 配置类已实现
- [ ] 工具类已实现

### 6.4 配置文件检查

- [ ] application.yml 配置正确
- [ ] bootstrap.yml 配置正确（如需要）
- [ ] 多环境配置支持

### 6.5 编译与启动检查

- [ ] 所有模块可以正常编译
- [ ] 可以正常打包
- [ ] Gateway 可以正常启动
- [ ] 服务可以注册到 Nacos

---

## 七、常见问题与解决方案

### 7.1 依赖问题

**问题**: AgentScope Java 1.0.7 依赖无法解析
- **解决方案**: 检查 Maven 仓库配置，确保可以访问 Maven Central 或阿里云镜像

**问题**: Java 版本不兼容
- **解决方案**: 确保使用 Java 21，检查 JAVA_HOME 环境变量

### 7.2 编译问题

**问题**: 编译错误：找不到符号
- **解决方案**: 检查包路径、导入语句，确保依赖已正确添加

**问题**: 编码问题（中文乱码）
- **解决方案**: 在 POM 中配置 `<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>`

### 7.3 启动问题

**问题**: Nacos 连接失败
- **解决方案**: 检查 Nacos Server 是否启动，检查配置的地址和端口

**问题**: 数据库连接失败
- **解决方案**: 检查数据库是否启动，检查连接配置（URL、用户名、密码）

**问题**: Redis 连接失败
- **解决方案**: 检查 Redis 是否启动，检查连接配置

### 7.4 配置问题

**问题**: 配置文件找不到
- **解决方案**: 检查配置文件路径，确保在 `src/main/resources` 目录下

**问题**: 配置属性不生效
- **解决方案**: 检查配置类注解（`@Configuration`、`@EnableConfigurationProperties`），检查属性绑定

---

## 八、后续工作建议

### 8.1 完善功能

1. **完善 Agent 核心模块**:
   - 实现完整的 Agent 执行引擎
   - 完善工具管理
   - 完善记忆管理

2. **完善框架模块**:
   - 添加更多配置类
   - 完善全局异常处理
   - 添加更多工具类

3. **完善 Gateway**:
   - 添加认证鉴权
   - 添加限流熔断
   - 添加监控指标

### 8.2 开发规范

1. **代码规范**:
   - 配置 Checkstyle 或 SpotBugs
   - 配置代码格式化规则

2. **测试规范**:
   - 添加单元测试框架（JUnit 5）
   - 添加集成测试框架
   - 配置测试覆盖率

3. **文档规范**:
   - 完善 API 文档（SpringDoc）
   - 完善开发文档
   - 完善部署文档

### 8.3 开发工具

1. **IDE 配置**:
   - 配置代码模板
   - 配置代码格式化
   - 配置代码检查

2. **构建工具**:
   - 配置 CI/CD（如需要）
   - 配置代码质量检查

---

## 九、执行时间表

### 9.1 建议执行顺序

1. **第1天**: 阶段一（项目初始化）+ 阶段二部分（common、framework）
2. **第2天**: 阶段二剩余（agent-core、gateway）
3. **第3天**: 阶段三（业务模块示例）+ 阶段四（配置与验证）

### 9.2 里程碑

- **M1**: 项目结构搭建完成（阶段一完成）
- **M2**: 核心模块搭建完成（阶段二完成）
- **M3**: 基础架构验证通过（阶段四完成）

---

## 十、总结

本执行计划详细描述了 Lumina 项目基础架构的搭建过程，包括：

1. **项目初始化** - 创建项目结构和根 POM
2. **核心模块搭建** - 搭建 common、framework、agent-core、gateway
3. **业务模块示例** - 创建示例模块验证架构
4. **配置与验证** - 配置开发环境，验证编译和启动

**关键成功因素**:
- 严格按照设计文档执行
- 每个阶段完成后进行验证
- 遇到问题及时记录和解决
- 保持代码质量和规范

**下一步**:
- 完成基础架构搭建后，可以开始业务模块开发
- 参考 `业务模块开发指南.md` 进行业务开发
- 参考 `工具开发指南.md` 进行工具开发

---

**文档版本**: v1.0  
**创建时间**: 2025-01-XX  
**最后更新**: 2025-01-XX

