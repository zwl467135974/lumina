# Lumina 项目剩余任务清单

## 📊 当前完成度评估

### 总体完成度：**85%**

| 模块 | 完成度 | 状态 |
|------|--------|------|
| lumina-common | 100% | ✅ 完成 |
| lumina-framework | 100% | ✅ 完成 |
| lumina-agent-core | 85% | ⚠️ 核心完成，待集成 AgentScope |
| lumina-gateway | 90% | ⚠️ 基础完成，待完善路由 |
| lumina-business-agent | 90% | ⚠️ 结构完成，待持久化实现 |
| lumina-frontend | 95% | ✅ 核心完成 |

---

## 🎯 剩余任务清单

### 一、高优先级任务（必须完成）

#### 1. AgentScope 真实集成 🔴

**当前状态**: `DefaultAgentExecutionEngine.executeAgentWithAgentScope()` 为模拟实现

**需要完成**:
- [ ] 修改 `lumina-agent-core/src/main/java/io/lumina/agent/engine/impl/DefaultAgentExecutionEngine.java`
- [ ] 参考 AgentScope Java 官方文档集成 SDK
- [ ] 实现 ReAct Agent 执行
- [ ] 实现工具调用（Tool Calling）
- [ ] 实现流式输出（可选）
- [ ] 添加错误处理和重试机制

**预期工作量**: 4-6 小时

**参考文档**:
- AgentScope Java: https://github.com/modelscope/agentscope-java
- 文档: https://java.agentscope.io/

---

#### 2. 数据持久化实现 🔴

**当前状态**: Service 层为模拟实现，TODO 标记待实现数据库操作

**需要完成**:
- [ ] 修改 `AgentServiceImpl`，移除模拟代码
- [ ] 集成 `AgentMapper` 实现真实 CRUD
- [ ] 实现 DO 与 Domain 的转换
- [ ] 添加事务管理
- [ ] 编写单元测试

**代码位置**: `lumina-modules/lumina-business-agent/src/main/java/io/lumina/agent/service/impl/AgentServiceImpl.java`

**预期工作量**: 2-3 小时

---

#### 3. 记忆管理器 Redis 持久化 🟡

**当前状态**: 仅内存实现，数据不持久化

**需要完成**:
- [ ] 修改 `MemoryManager`，添加 Redis 持久化
- [ ] 实现 Redis 序列化（Jackson）
- [ ] 添加记忆 TTL 配置
- [ ] 实现记忆清理策略

**代码位置**: `lumina-agent-core/src/main/java/io/lumina/agent/manager/MemoryManager.java`

**预期工作量**: 2-3 小时

---

#### 4. Gateway 动态路由配置 🟡

**当前状态**: 静态配置，不支持动态更新

**需要完成**:
- [ ] 配置从 Nacos 读取路由
- [ ] 实现路由动态刷新
- [ ] 添加路由限流配置
- [ ] 添加路由熔断配置
- [ ] 添加 JWT 认证过滤器

**代码位置**:
- `lumina-gateway/src/main/resources/application.yml`
- 新建 Gateway 过滤器类

**预期工作量**: 3-4 小时

---

#### 5. 配置加载器 Nacos 集成 🟡

**当前状态**: 仅支持 classpath 资源

**需要完成**:
- [ ] 修改 `ConfigLoader`，支持 Nacos 配置中心
- [ ] 实现配置热更新
- [ ] 添加配置优先级处理
- [ ] 添加配置验证

**代码位置**: `lumina-agent-core/src/main/java/io/lumina/agent/loader/ConfigLoader.java`

**预期工作量**: 2-3 小时

---

### 二、中优先级任务（建议完成）

#### 6. 前端状态持久化 🟡

**当前状态**: Pinia 状态未持久化

**需要完成**:
- [ ] 安装 `pinia-plugin-persistedstate`
- [ ] 配置持久化策略
- [ ] 持久化用户状态和应用状态
- [ ] 添加状态恢复逻辑

**代码位置**: `lumina-frontend/src/stores/`

**预期工作量**: 1-2 小时

---

#### 7. 前端权限管理 🟡

**当前状态**: 路由守卫未实现权限检查

**需要完成**:
- [ ] 创建 `permission.ts` Store
- [ ] 实现权限检查逻辑
- [ ] 添加权限指令
- [ ] 动态路由加载（基于权限）

**代码位置**: `lumina-frontend/src/stores/modules/permission.ts`

**预期工作量**: 2-3 小时

---

#### 8. JWT 认证集成 🔴

**当前状态**: JWT 工具类已创建，未集成到认证流程

**需要完成**:
- [ ] 创建用户登录 API
- [ ] 实现 JWT Token 生成和返回
- [ ] 实现 Token 校验过滤器
- [ ] 前端 Token 存储和自动刷新
- [ ] 登出功能清除 Token

**预期工作量**: 3-4 小时

---

#### 9. 前端 API 完整实现 🟡

**当前状态**: 基础 API 已定义

**需要完成**:
- [ ] 完善 Agent API（所有 CRUD 操作）
- [ ] 实现用户认证 API（登录、登出、获取用户信息）
- [ ] 添加请求重试机制
- [ ] 添加请求取消机制

**代码位置**: `lumina-frontend/src/api/modules/`

**预期工作量**: 2-3 小时

---

#### 10. 前端页面完善 🟡

**当前状态**: 仅有列表页和详情页

**需要完成**:
- [ ] 创建 Agent 创建/编辑表单页
- [ ] 实现 Agent 对话页面（流式输出）
- [ ] 添加用户管理页面
- [ ] 添加系统配置页面
- [ ] 完善 404 和 500 错误页

**代码位置**: `lumina-frontend/src/views/`

**预期工作量**: 6-8 小时

---

### 三、低优先级任务（后续完善）

#### 11. 单元测试 🟢

**需要完成**:
- [ ] Agent 工具测试
- [ ] Agent 执行引擎测试
- [ ] Service 层测试
- [ ] API 层测试
- [ ] 目标覆盖率：70%+

**预期工作量**: 8-10 小时

---

#### 12. 监控和指标 🟢

**需要完成**:
- [ ] 集成 Spring Boot Actuator
- [ ] 配置健康检查端点
- [ ] 集成 Micrometer 指标收集
- [ ] 集成分布式链路追踪（Sleuth + Zipkin）

**预期工作量**: 4-5 小时

---

#### 13. API 文档 🟢

**需要完成**:
- [ ] 集成 SpringDoc（Swagger）
- [ ] 配置 API 文档注解
- [ ] 生成 API 文档页面
- [ ] 添加接口示例

**预期工作量**: 2-3 小时

---

#### 14. Docker 部署配置 🟢

**需要完成**:
- [ ] 编写 Dockerfile（各模块）
- [ ] 编写 docker-compose.yml
- [ ] 配置容器编排
- [ ] 编写部署文档

**预期工作量**: 3-4 小时

---

#### 15. CI/CD 配置 🟢

**需要完成**:
- [ ] 配置 GitHub Actions
- [ ] 自动化构建和测试
- [ ] 自动化部署
- [ ] 配置代码质量检查

**预期工作量**: 4-5 小时

---

## 📅 建议实施计划

### 第 1 周：核心功能集成

**目标**: 让项目可以真正运行

1. **Day 1-2**: AgentScope 集成
   - 实现 `DefaultAgentExecutionEngine` 真实执行
   - 测试 Agent 执行功能

2. **Day 3**: 数据持久化
   - 实现 AgentServiceImpl 的数据库操作
   - 测试 CRUD 功能

3. **Day 4**: 记忆管理器 Redis 持久化
   - 实现持久化逻辑
   - 测试记忆存储和检索

4. **Day 5**: JWT 认证集成
   - 实现登录 API
   - 实现前端 Token 管理
   - 测试认证流程

### 第 2 周：功能完善

1. **Day 1-2**: Gateway 动态路由
   - 配置 Nacos 动态路由
   - 实现路由刷新

2. **Day 3**: 配置加载器 Nacos 集成
   - 实现配置热更新

3. **Day 4-5**: 前端页面完善
   - 创建/编辑表单
   - Agent 对话页面

### 第 3 周：测试和文档

1. **Day 1-3**: 单元测试
   - 核心功能测试
   - 达到 70% 覆盖率

2. **Day 4**: API 文档
   - 集成 SpringDoc
   - 生成文档

3. **Day 5**: Docker 部署
   - 编写 Dockerfile
   - 配置 docker-compose

---

## 🔥 最关键的 3 个任务

如果时间有限，优先完成这 3 个任务：

### 1. AgentScope 真实集成 🔴
**影响**: 核心功能，无法真正执行 Agent
**工作量**: 4-6 小时
**优先级**: P0

### 2. 数据持久化实现 🔴
**影响**: 数据无法保存，无法正常使用
**工作量**: 2-3 小时
**优先级**: P0

### 3. JWT 认证集成 🔴
**影响**: 无法进行用户认证和授权
**工作量**: 3-4 小时
**优先级**: P0

---

## 📊 剩余工作量估算

| 优先级 | 任务数 | 预计工作量 |
|--------|--------|-----------|
| **高优先级（P0）** | 5 | 13-19 小时 |
| **中优先级（P1）** | 5 | 14-21 小时 |
| **低优先级（P2）** | 5 | 21-27 小时 |
| **总计** | 15 | **48-67 小时** |

按每天工作 6 小时计算：
- **高优先级**: 约 2-3 天
- **全部完成**: 约 8-11 天

---

## ✅ 快速启动检查清单

如果想立即开始开发，请按顺序检查：

- [ ] MySQL、Redis、Nacos 已启动
- [ ] 数据库和表已创建
- [ ] 所有模块可以编译成功（`mvn clean compile`）
- [ ] 可以启动 Gateway 模块
- [ ] 可以启动业务模块
- [ ] 前端可以运行（`pnpm dev`）
- [ ] 前端可以调用后端 API

---

**文档版本**: v1.0
**创建时间**: 2025-01-19
**最后更新**: 2025-01-19
