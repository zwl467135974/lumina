# 配置管理规范

## 一、配置层次

### 1.1 配置优先级

1. **运行时配置**（代码传入，最高优先级）
2. **业务模块配置**（`lumina-agent-{domain}/resources/agent-config/`）
3. **全局默认配置**（`lumina-agent-core/resources/agent-config/default.yaml`）

---

## 二、配置文件结构

### 2.1 Agent 业务配置

**位置**: `lumina-agent-{domain}/src/main/resources/agent-config/{business-type}.yaml`

**格式**: YAML

```yaml
agent:
  name: customer_service_agent          # Agent 名称
  description: 客服助手                # Agent 描述
  
  model:                                # 模型配置
    type: dashscope                     # 模型类型：dashscope, openai, gemini
    modelName: qwen-plus                # 模型名称
    apiKey: ${DASHSCOPE_API_KEY}        # API Key（环境变量）
    temperature: 0.7                     # 温度参数
    maxTokens: 2000                      # 最大 token 数
  
  prompt:                               # 提示词配置
    path: classpath:prompt/customer-service.md  # 提示词路径
    variables:                           # 提示词变量（可选）
      companyName: Lumina
  
  tools:                                # 工具配置
    - query_order                       # 工具名称列表
    - update_order_status
    - send_notification
  
  memory:                               # 记忆配置
    type: in_memory                     # 记忆类型：in_memory, long_term
    maxSize: 100                        # 最大消息数（in_memory）
    sessionId: ${sessionId}             # 会话ID（可选）
  
  execution:                            # 执行配置
    maxIterations: 10                   # 最大迭代次数
    timeout: 30000                      # 超时时间（毫秒）
    stream: false                       # 是否流式输出
```

---

## 三、提示词管理

### 3.1 提示词位置

**位置**: `lumina-agent-{domain}/src/main/resources/prompt/{prompt-name}.md`

### 3.2 提示词格式

```markdown
# 业务提示词

你是一个专业的客服助手，负责处理客户咨询。

## 角色定位
- 友好、专业、高效
- 准确理解客户需求
- 及时响应客户问题

## 可用工具
- query_order: 查询订单信息
  - 参数: orderId (订单ID)
- update_order_status: 更新订单状态
  - 参数: orderId (订单ID), status (新状态)

## 注意事项
- 保持友好和专业的态度
- 准确理解客户需求
- 及时响应客户问题
- 如遇到无法处理的问题，引导客户联系人工客服
```

### 3.3 提示词变量

支持变量替换：

```markdown
你好，欢迎使用 {{companyName}} 客服系统。
```

配置中定义：

```yaml
prompt:
  path: classpath:prompt/customer-service.md
  variables:
    companyName: Lumina
```

---

## 四、工具配置

### 4.1 工具注册方式

#### 方式1: 自动注册（推荐）

使用 Spring `@Component` 注解：

```java
@Component
public class OrderTools {
    @Tool(description = "查询订单")
    public String queryOrder(@ToolParam(name = "orderId") String orderId) {
        // ...
    }
}
```

#### 方式2: 手动注册

```java
@Configuration
public class ToolConfig {
    @Bean
    public AgentTool customTool() {
        return AgentTool.builder()
            .name("custom_tool")
            .description("自定义工具")
            .build();
    }
}
```

### 4.2 工具配置

在业务配置中指定工具名称：

```yaml
tools:
  - query_order          # 对应 OrderTools.queryOrder
  - update_order_status  # 对应 OrderTools.updateOrderStatus
```

---

## 五、环境变量配置

### 5.1 敏感信息

使用环境变量存储敏感信息：

```yaml
model:
  apiKey: ${DASHSCOPE_API_KEY}  # 从环境变量读取
```

### 5.2 配置覆盖

支持通过环境变量覆盖配置：

```bash
export LUMINA_AGENT_CUSTOMER_MODEL_NAME=qwen-max
export LUMINA_AGENT_CUSTOMER_MAX_ITERATIONS=20
```

---

## 六、多环境配置

### 6.1 配置文件命名

- `application.yaml` - 默认配置
- `application-dev.yaml` - 开发环境
- `application-prod.yaml` - 生产环境

### 6.2 环境特定配置

```yaml
# application-dev.yaml
agent:
  model:
    modelName: qwen-plus  # 开发环境使用较小模型
    
# application-prod.yaml
agent:
  model:
    modelName: qwen-max   # 生产环境使用较大模型
```

---

## 七、配置验证

### 7.1 必填项检查

- `agent.name` - Agent 名称
- `agent.model.type` - 模型类型
- `agent.model.modelName` - 模型名称
- `agent.prompt.path` - 提示词路径

### 7.2 配置校验

启动时校验配置：
- 提示词文件是否存在
- 工具是否已注册
- 模型配置是否有效

---

## 八、配置热更新

### 8.1 支持热更新的配置

- 提示词内容（需要重启）
- 工具配置（需要重启）
- 模型参数（运行时可调整）

### 8.2 不支持热更新的配置

- Agent 名称
- 模型类型
- 记忆类型

---

**文档版本**: v1.0  
**创建时间**: 2025-01-XX

